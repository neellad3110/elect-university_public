<!DOCTYPE html>
<html>

<head>
	<!-- Site made with Mobirise Website Builder v5.9.4, https://mobirise.com -->
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="generator" content="Mobirise v5.9.4, mobirise.com" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
	<link rel="shortcut icon" href="../static/assets/images/mbr-96x48.png" type="image/x-icon" />
	<meta name="description" content="" />

	<title>Reset Password</title>
	<link rel="stylesheet" href="../static/assets/web/assets/mobirise-icons2/mobirise2.css" />
	<link rel="stylesheet" href="../static/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css" />
	<link rel="stylesheet" href="../static/assets/bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" href="../static/assets/bootstrap/css/bootstrap-grid.min.css" />
	<link rel="stylesheet" href="../static/assets/bootstrap/css/bootstrap-reboot.min.css" />
	<link rel="stylesheet" href="../static/assets/parallax/jarallax.css" />
	<link rel="stylesheet" href="../static/assets/animatecss/animate.css" />
	<link rel="stylesheet" href="../static/assets/dropdown/css/style.css" />
	<link rel="stylesheet" href="../static/assets/socicon/css/styles.css" />
	<link rel="stylesheet" href="../static/assets/theme/css/style.css" />
	<link rel="stylesheet" href="../static/assets/table/style.css" />
	<link rel="stylesheet" href="../static/assets/modal/style.css" />

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css" />
	<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		crossorigin="anonymous"></script>
	<script src="../static/assets/typewriting/typewriting.js"></script>

	<link rel="preload"
		href="https://fonts.googleapis.com/css?family=Inter+Tight:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap"
		as="style" onload="this.onload=null;this.rel='stylesheet'" />
	<noscript>
		<link rel="stylesheet"
			href="https://fonts.googleapis.com/css?family=Inter+Tight:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap" />
	</noscript>
	<link rel="preload" as="style" href="../static/assets/mobirise/css/mbr-additional.css" />
	<link rel="stylesheet" href="../static/assets/mobirise/css/mbr-additional.css" type="text/css" />

	<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
	<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>


	<style>
		.height-100 {
			height: 80vh;
		}

		.forgotpasscard {
			width: 550px;
			border: none;
			height: 500px;
			box-shadow: 0px 5px 20px 0px #d2dae3;
			z-index: 1;
			display: flex;
			justify-content: center;
			align-items: center
		}

		.forgotpasscard h6 {
			color: #5e9f7e;
			font-size: 20px
		}

		.otpinputs input {
			width: 60px;
			height: 60px;
			color: black !important;
			border-radius: 20px !important;
			border: 1px solid black;
		}

		input[type=number]::-webkit-inner-spin-button,
		input[type=number]::-webkit-outer-spin-button {
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			margin: 0
		}

		.card-2 {
			background-color: #fff;
			padding: 10px;
			width: 500px;
			height: 100px;
			bottom: -50px;
			left: 20px;
			position: absolute;
			border-radius: 5px
		}

		
		

		.otpform-control:focus {
			box-shadow: none;
			border: 2px solid #5e9f7e;

		}

		.validate {
			border-radius: 50px;
			
		}
		
	</style>
</head>

<body>
	<!-- registration modal -->
	<div tabindex="-1" class="modal pmd-modal fade" id="form-dialog" style="display: none" aria-hidden="true">
		<div class="modal-dialog" style="height: auto !important">
			<div class="modal-content" style="border-radius: 30px !important">
				<div class="row">
					<div class="col-12 mb-5" style="padding-top: 20px; padding-right: 50px">
						<button aria-hidden="true" data-dismiss="modal" class="close" id="modalclosebtn" style="
                  height: 10px;
                  width: 10px;
                  border-radius: 50px;
                  float: right;
                " type="button">
							X
						</button>
					</div>
				</div>
				<div class="row justify-content-center">
					<div class="col-12 content-head">
						<div class="mbr-section-head mb-5" mbr-if="showTitle || showSubtitle">
							<h3 class="mbr-section-title mbr-fonts-style display-5 align-center mb-0"
								mbr-theme-style="display-2" data-app-selector=".mbr-section-title">
								<b>Filter</b>
							</h3>
						</div>
					</div>
				</div>
				<div class="row justify-content-center">
					<div mbr-form="" class="col-lg10 mx-auto mbr-form">
						<form name="authenticate_form" method="POST" id="filterform" class="mbr-form form-with-styler">
							<div class="row">
								<div hidden="hidden" data-form-alert="" class="alert alert-success col-12">
									Thanks for filling out the form!
								</div>
								<div hidden="hidden" data-form-alert-danger="" class="alert alert-danger col-12">
									Oops...! some problem!
								</div>
							</div>
							<div class="row">
								<div class="col-12 form-group mb-3 align-center">
									<select id="selectregion" name="selectregion" title="Select Region"
										class="selectpicker w-75 rounded" data-live-search="true"
										data-size="6"></select>
								</div>
								<div class="col-12 form-group mb-3 align-center">
									<select id="selectcountry" name="selectcountry" title="Select Country"
										class="selectpicker w-75 rounded" data-live-search="true"
										data-size="6"></select>
								</div>

								<div class="col-12">
									<div class="row">
										<div class="col-lg-3 col-md-3 col-sm-3"></div>
										<div class="col-lg-4 col-md-4 col-sm-4 mbr-section-btn">
											<a type="submit" class="btn btn-secondary">Reset</a>
										</div>
										<div class="col-lg-4 col-md-4 col-sm-4 mbr-section-btn">
											<a type="submit" class="btn btn-primary">Apply</a>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<section data-bs-version="5.1" class="menu menu2 cid-tRs56tz0PF" once="menu" id="menu2-f">
		<nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
			<div class="container">
				<div class="navbar-brand">
					<span class="navbar-logo">
						<a href="">
							<img src="../static/assets/images/mbr-96x48.png" style="height: 3rem" />
						</a>
					</span>
					<span class="navbar-caption-wrap"><a class="navbar-caption text-black display-7" href="{{url_for('home')}}">Elect
							University</a></span>
				</div>
			</div>
		</nav>
	</section>

	<div class="container height-100 d-flex justify-content-center align-items-center">
		<div class="position-relative">
			<div class="card forgotpasscard p-1 text-center">
				<div id="inputotpcard" > 
					<h6>
						Please enter the one time password <br />
						to recover your account
					</h6>
					<div>
						<span>A code has been sent to</span> <label id="recipientemail"></label>
					</div>
					<form id="validateotp" method="post" >
						<input type="hidden" name="authtype" value="2" />
						<div id="otp" class="otpinputs d-flex flex-row justify-content-center mt-2">
							<input class="m-2 text-center otpform-control rounded" type="text" name="first" id="first" maxlength="1" />
							<input class="m-2 text-center otpform-control rounded" type="text" name="second" id="second" maxlength="1" />
							<input class="m-2 text-center otpform-control rounded" type="text" name="third" id="third" maxlength="1" />
							<input class="m-2 text-center otpform-control rounded" type="text" name="fourth" id="fourth" maxlength="1" />
							<input class="m-2 text-center otpform-control rounded" type="text" name="fifth" id="fifth" maxlength="1" />
							<input class="m-2 text-center otpform-control rounded" type="text" name="sixth" id="sixth" maxlength="1" />
						</div>
						<div class="mt-2">
							<span>Resend OTP : </span><label id="timertext"></label>
						</div>

						<div class="mt-2">
							<label id="errortext" style="color:red"></label>
						</div>
						<div class="mt-4">
							<button type="submit" class="btn btn-primary display-4 validate">Verify</button>
						</div>
					</form>
				</div>
				<div id="inputemailcard" >
					<h4>
						Please enter your registered email.
					</h4>
					<form id="validate_email" method="post">
						<input type="email" name="resetemail" id="resetemail" placeholder="Enter email" class="form-control mt-4" ">
						<div class="mt-4">
							<button type="submit" class="btn btn-primary display-4 validate">Request OTP</button>
						</div>

					</form>
					
				</div>
				<div id="newpasscard" >
					<h4>
						Reset Password
					</h4>
					<form id="setnewpassword" method="post">
						<input type="password" name="newpassword" id="newpassword" placeholder="Enter new password" class="form-control mt-4" ">
						<input type="password" name="confnewpassword" id="confnewpassword" placeholder="Retype password" class="form-control mt-4" ">
						<div class="mt-4">
							<button type="submit" class="btn btn-primary display-4 validate">Reset</button>
						</div>

					</form>
					
				</div>
				<div id="pswdsuccess" >
					<h4>
						Password reset successfully.
					</h4>
					<label class="mt-4"><h5>Redirecting to home page ...</h5></label>
				</div>

			</div>
		</div>
	</div>
    <div id="loader" class="loader">
        <div class="loader-content">
            <!-- Loader content if necessary -->
        </div>
	</div>	
	<!-- <script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/parallax/jarallax.js"></script>
    <script src="assets/smoothscroll/smooth-scroll.js"></script>
    <script src="assets/ytplayer/index.js"></script>
    <script src="assets/dropdown/js/navbar-dropdown.js"></script>
    <script src="assets/theme/js/script.js"></script>
    <script src="assets/formoid/formoid.min.js"></script> -->

	<input name="animation" type="hidden" />
</body>

</html>
<script>
	$(document).ready(function () {
		$("#newpasscard").hide();
		$("#inputotpcard").hide();
		$("#pswdsuccess").hide();
		$("#inputemailcard").show();
		// $(".selectpicker").selectpicker();
		// $("#filtermodal").hide();
		// $("#filtermodalbtn").click(function () {
		//     $("#form-dialog").modal("show");
		// });
		// $("#modalclosebtn").click(function () {
		//     $("#filterform").trigger("reset");
		//     $("#form-dialog").modal("toggle"); // Show the modal
		// });


		$("#validate_email").validate({
			rules:{
				resetemail:{ required:true }
			},
			messages:{
				resetemail :{ required:"Email is required." }
			},
			submitHandler:function(form){
				$("#loader").show();
				recipientemail=$("#resetemail").val();
				formData=$("#validate_email").serialize();
				$.ajax({

						type: "POST",
						url: '/validate_email',
						data: formData,
						dataType: "json",
						success:function(response){
							$("#loader").hide();
							if(response.status==1){
								
								setupverification();
								
								$("#inputemailcard").hide();
								$("#inputotpcard").show();
								$("#recipientemail").html(recipientemail);
								
								
							}else{
								alert("Email address not found");
							}
						}
				});
			}
		});

		$("#setnewpassword").validate({
			rules:{
				newpassword:{required:true,minlength:8},
				confnewpassword:{required:true,equalTo:"#newpassword"}

			},
			messages:{
				newpassword:{
					required:"New Password is required",
					minlength:"New password should have atlest 8 characters."
				},
				confnewpassword:{
					required:"Please retype your new password.",
					equalTo:"Both passwords should be equal"
				}
			},
			submitHandler:function(form){

				$("#loader").show();
				formdata=$("#setnewpassword").serialize();
				
				$.ajax({
						type: "POST",
						url: '/resetnewpassword',
						data:formdata,
						dataType: "json",
						success:function(response){
							$("#loader").hide()
							if(response.status==1){
									$("#newpasscard").hide()
									$("#pswdsuccess").show()
									setInterval(function(){
										window.location.href="{{url_for('home')}}";
									},3000)
									
							}else{
								alert(response.message);
							}
						}
				});
			}
		});

		$("#validateotp").submit(function(e){
			e.preventDefault();

			if($('#first').val() && $('#second').val() && $('#third').val() && $('#fourth').val() && $('#fifth').val() && $('#sixth').val()){
					
					$("#loader").show();
					formData=$("#validateotp").serialize();


					$.ajax({

						type: "POST",
						url: '/authtoken',
						data:formData,
						dataType: "json",
						success:function(response){

								$("#loader").hide()	
								if(response.status==1){
									resendtoken()
									$("#inputotpcard").hide()
									$("#newpasscard").show()
									
								}else{
									$("#errortext").html(response.message);
								}
								
						}
					});

			}else{
				$("#errortext").html("All digits are required.");
			}
		});


	});

	document.addEventListener("DOMContentLoaded", function (event) {
		function OTPInput() {
			const inputs = document.querySelectorAll("#otp > *[id]");
			for (let i = 0; i < inputs.length; i++) {
				inputs[i].addEventListener("keydown", function (event) {

					var key = event.which || event.keyCode;

        // Allow only numeric keys (0-9) and some special keys like Backspace, Enter, etc.
					if ((key < 48 || key > 57) && key !== 8 && key !== 13 && key !== 37 && key !== 39) {
						event.preventDefault();
				}
				else{
					if (event.key === "Backspace") {
						inputs[i].value = "";
						if (i !== 0) inputs[i - 1].focus();
					} else {
						if (i === inputs.length - 1 && inputs[i].value !== "") {
							return true;
						} else if (event.keyCode > 47 && event.keyCode < 58) {
							inputs[i].value = event.key;
							if (i !== inputs.length - 1) inputs[i + 1].focus();
							event.preventDefault();
						} else if (event.keyCode > 64 && event.keyCode < 91) {
							inputs[i].value = String.fromCharCode(event.keyCode);
							if (i !== inputs.length - 1) inputs[i + 1].focus();
							event.preventDefault();
						}
					}
				}
					
				});
			}
		}
		OTPInput();
	});

	function resendtoken(){

			$("#errortext").html('');
			$("#validateotp").trigger("reset");
			$("#timertext").html('')
			var timeLeft = 10;
			var timerId = setInterval(function(){

				if (timeLeft == 0) {
					clearTimeout(timerId);
					$("#timertext").html("<a href='#' onclick='setupverification()'><u>Resend</u></a>");
				} else {
					if(timeLeft==1){
						$("#timertext").html(" "+timeLeft+" second.")
					}
					else{
						$("#timertext").html(" "+timeLeft+" seconds.")
					}
					timeLeft--;
				}

			}, 1000);

	}

	function setupverification(){
		$("#loader").show();
			$.ajax({

						type: "POST",
						url: '/emailconfirmation',
						data:{'type':2},
						dataType: "json",
						success:function(response){
							$("#loader").hide();
								resendtoken()
						}
			});
		
	}


</script>